<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignite Type | Gamified Typing Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Typefire" />
    <link rel="manifest" href="/site.webmanifest" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* --- CSS VARIABLES & THEME SYSTEM --- */
        :root {
            /* Default: Cyberpunk */
            --bg-color: #050510;
            --bg-grid: rgba(0, 255, 249, 0.05);
            --text-main: #00fff9;
            --text-dim: rgba(0, 255, 249, 0.3);
            --card-bg: rgba(13, 2, 33, 0.7);
            --card-border: 1px solid rgba(0, 255, 249, 0.3);
            --card-shadow: 0 0 20px rgba(0, 255, 249, 0.1);
            --header-bg: rgba(0, 255, 249, 0.1);
            
            --key-bg: #1a1a2e;
            --key-top: #232342;
            --key-border: #00fff9;
            --key-text: #fff;
            --key-shadow: 0 4px 0 #0d0221;
            
            --key-active-bg: #ff00ff;
            --key-active-shadow: 0 0 0 #0d0221;
            
            --accent: #ff00ff;
            --glow: 0 0 10px rgba(0, 255, 249, 0.5);
            
            --font-main: 'JetBrains Mono', monospace;
            --font-display: 'JetBrains Mono', monospace; /* 'Press Start 2P' used selectively */
            
            --fire-base: 180; /* Hue for fire (Cyan) */
            --cursor-color: #ff00ff;
            
            --scanline-opacity: 0.15;
        }

        body.theme-glass {
            --bg-color: #eef2ff;
            --bg-grid: rgba(59, 130, 246, 0.1);
            --text-main: #334155;
            --text-dim: #94a3b8;
            --card-bg: rgba(255, 255, 255, 0.6);
            --card-border: 1px solid rgba(255, 255, 255, 0.8);
            --card-shadow: 0 10px 30px rgba(59, 130, 246, 0.15);
            --header-bg: rgba(59, 130, 246, 0.1);
            
            --key-bg: #fff;
            --key-top: #f8fafc;
            --key-border: #cbd5e1;
            --key-text: #334155;
            --key-shadow: 0 4px 0 #cbd5e1;
            
            --key-active-bg: #3b82f6;
            --key-active-shadow: 0 0 0 #cbd5e1;
            
            --accent: #3b82f6;
            --font-main: 'JetBrains Mono', monospace;
            --font-display: 'JetBrains Mono', monospace;
            --fire-base: 220; 
            --cursor-color: #3b82f6;
            --scanline-opacity: 0.05;
        }

        body.theme-pixel {
            --bg-color: #1a1b26;
            --bg-grid: rgba(255, 255, 255, 0.05);
            --text-main: #a9b1d6;
            --text-dim: #565f89;
            --card-bg: #24283b;
            --card-border: 4px solid #16161e;
            --card-shadow: 8px 8px 0 #000;
            --header-bg: #16161e;
            
            --key-bg: #414868;
            --key-top: #414868;
            --key-border: #16161e;
            --key-text: #c0caf5;
            --key-shadow: 4px 4px 0 #16161e;
            
            --key-active-bg: #f7768e;
            --key-active-shadow: 0 0 0 #16161e;
            
            --accent: #7aa2f7;
            --font-main: 'JetBrains Mono', monospace;
            --font-display: 'Press Start 2P', cursive;
            --fire-base: 10; 
            --cursor-color: #9ece6a;
            --scanline-opacity: 0.1;
        }

        body.theme-bento {
            --bg-color: #f4f4f5;
            --bg-grid: rgba(0,0,0,0.05);
            --text-main: #27272a;
            --text-dim: #a1a1aa;
            --card-bg: #ffffff;
            --card-border: 1px solid #e4e4e7;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --header-bg: #fafafa;
            
            --key-bg: #e4e4e7;
            --key-top: #f4f4f5;
            --key-border: #d4d4d8;
            --key-text: #18181b;
            --key-shadow: 0 2px 0 #d4d4d8;
            
            --key-active-bg: #27272a;
            --key-active-shadow: 0 0 0 #d4d4d8;
            
            --accent: #d97706;
            --font-main: 'JetBrains Mono', monospace;
            --font-display: 'JetBrains Mono', monospace;
            --fire-base: 35;
            --cursor-color: #d97706;
            --scanline-opacity: 0;
        }

        body.theme-retro {
            --bg-color: #008080;
            --bg-grid: transparent;
            --text-main: #000;
            --text-dim: #444;
            --card-bg: #c0c0c0;
            --card-border: 2px solid #fff;
            --card-shadow: 4px 4px 0 #000;
            --header-bg: #000080;
            
            --key-bg: #c0c0c0;
            --key-top: #c0c0c0;
            --key-border: #808080;
            --key-text: #000;
            --key-shadow: 2px 2px 0 #000;
            
            --key-active-bg: #000080;
            --key-active-shadow: 0 0 0 #000;
            
            --accent: #000080;
            --font-main: 'JetBrains Mono', monospace;
            --font-display: 'JetBrains Mono', monospace;
            --fire-base: 0; 
            --cursor-color: #000;
            --scanline-opacity: 0.05;
        }

        /* --- BASE STYLES --- */
        * { box-sizing: border-box; user-select: none; }
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            background-image: 
                linear-gradient(var(--bg-grid) 1px, transparent 1px),
                linear-gradient(90deg, var(--bg-grid) 1px, transparent 1px);
            background-size: 30px 30px;
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
            position: relative;
        }

        /* Retro CRT Scanlines & Vignette */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.5) 50%,
                rgba(0,0,0,0.5)
            );
            background-size: 100% 4px;
            opacity: var(--scanline-opacity);
            pointer-events: none; z-index: 9998;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.4) 100%);
            pointer-events: none; z-index: 9999;
        }

        /* --- BENTO LAYOUT --- */
        .app-container {
            display: grid;
            grid-template-areas: 
                "stats stats"
                "pet arena"
                "pet keyboard"
                "bottom bottom";
            grid-template-columns: 240px 1fr;
            grid-template-rows: 60px 1fr auto 50px;
            gap: 16px;
            padding: 24px;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Card System with "Window" feel */
        .card {
            background: var(--card-bg);
            border: var(--card-border);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(12px);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card-header {
            height: 28px;
            background: var(--header-bg);
            border-bottom: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            font-weight: 700;
        }
        
        .card-body {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        /* Theme Overrides for Cards */
        body.theme-retro .card { border-radius: 0; border: 2px solid #fff; border-right-color: #444; border-bottom-color: #444; box-shadow: none; }
        body.theme-retro .card-header { color: #fff; background: var(--header-bg); }
        body.theme-pixel .card { border-radius: 0; }

        /* --- AREAS --- */
        .area-stats { 
            grid-area: stats; 
            flex-direction: row; 
            align-items: center; 
            padding: 0; /* padding handled by card-body */
        }
        .stats-grid {
            display: flex; width: 100%; height: 100%;
            align-items: center; justify-content: space-between;
            padding: 0 24px;
        }
        
        .area-pet { grid-area: pet; }
        .area-arena { grid-area: arena; }
        .area-keyboard { grid-area: keyboard; padding: 20px; }
        .area-bottom { grid-area: bottom; flex-direction: row; align-items: center; padding: 0 16px; font-size: 0.8rem; }

        /* --- STATS ITEMS --- */
        .stat-item {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .stat-label { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px; }
        .stat-value { font-size: 1.2rem; font-weight: 800; color: var(--text-main); text-shadow: 0 0 10px rgba(0,255,249,0.3); }

        /* --- TYPING ARENA --- */
        .arena-wrapper {
            display: flex; flex-direction: column;
            justify-content: center; align-items: flex-start;
            height: 100%; width: 100%;
            padding: 40px;
            position: relative;
        }

        .text-display {
            font-size: 2rem;
            line-height: 1.6;
            text-align: left;
            width: 100%;
            white-space: pre-wrap;
            word-break: break-word;
            font-family: var(--font-main);
            position: relative;
            z-index: 10;
        }

        .char { color: var(--text-dim); position: relative; transition: color 0.1s; }
        .char.correct { color: var(--text-main); text-shadow: 0 0 8px var(--text-main); }
        .char.incorrect { color: #ef4444; text-decoration: underline; text-decoration-thickness: 3px; }
        .char.current { 
            background: var(--cursor-color); 
            color: var(--bg-color); 
            box-shadow: 0 0 10px var(--cursor-color);
            animation: blink 1s infinite step-end;
        }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .ghost-char {
            position: absolute; font-size: 2rem; color: var(--accent);
            pointer-events: none; animation: floatUp 0.6s ease-out forwards;
            font-weight: bold;
        }
        @keyframes floatUp {
            0% { transform: translate(-50%, 0) scale(1); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--drift)), -40px) scale(1.5); opacity: 0; }
        }

        .combo-counter {
            position: absolute; bottom: 20px; right: 30px;
            font-size: 3rem; font-weight: 900;
            color: transparent; -webkit-text-stroke: 1px var(--accent);
            opacity: 0; transform: skewX(-10deg) translateY(20px);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: var(--font-display);
        }
        .combo-counter.visible { opacity: 1; transform: skewX(-10deg) translateY(0); }

        /* --- KEYBOARD --- */
        .keyboard-wrapper {
            position: relative;
            padding: 10px;
            border-radius: 12px;
            transform-origin: center bottom;
            transition: transform 0.1s;
            margin: 0 auto;
        }
        .keyboard-wrapper.shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

        .kb-row { display: flex; justify-content: center; margin-bottom: 8px; }

        .key {
            width: 54px; height: 54px; margin: 0 4px;
            position: relative;
            background-color: var(--key-bg);
            border-radius: 6px;
            box-shadow: var(--key-shadow);
            transition: transform 0.05s;
            z-index: 5;
        }

        /* Key Top Cap */
        .key::before {
            content: attr(data-label);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--key-top);
            border: 1px solid var(--key-border);
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-family: var(--font-main);
            font-size: 14px; font-weight: bold;
            color: var(--key-text);
            z-index: 2;
            transition: background 0.1s, border-color 0.1s;
        }
        
        /* Specific Retro Theme Tweaks */
        body.theme-pixel .key { border-radius: 0; }
        body.theme-pixel .key::before { border-radius: 0; border-width: 2px; }
        body.theme-retro .key { border-radius: 0; }
        body.theme-retro .key::before { 
            border-radius: 0; 
            border-top: 2px solid #fff; border-left: 2px solid #fff;
            border-right: 2px solid #444; border-bottom: 2px solid #444; 
        }

        .key.active {
            transform: translateY(4px);
            box-shadow: var(--key-active-shadow);
        }
        .key.active::before {
            background: var(--key-active-bg);
            border-color: var(--key-active-bg);
            color: #fff;
        }

        .key.next-hint::before {
            border-color: var(--accent);
            box-shadow: inset 0 0 10px var(--accent);
            text-shadow: 0 0 5px var(--accent);
        }

        /* Key Sizes */
        .key.w-1-5 { width: 81px; }
        .key.w-1-75 { width: 94.5px; }
        .key.w-2 { width: 108px; }
        .key.w-2-25 { width: 121.5px; }
        .key.w-2-5 { width: 135px; }
        .key.w-6 { width: 334px; }

        /* Finger Markers */
        body.show-fingers .key.finger-p-l::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#a855f7; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-r-l::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#3b82f6; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-m-l::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#22c55e; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-i-l::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#eab308; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-i-r::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#eab308; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-m-r::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#22c55e; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-r-r::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#3b82f6; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-p-r::after { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#a855f7; z-index:3; opacity:0.7; }
        body.show-fingers .key.finger-t::after   { content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:#f97316; z-index:3; opacity:0.7; }

        #fire-canvas {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 20; mix-blend-mode: screen;
        }
        body.theme-pixel #fire-canvas { image-rendering: pixelated; }

        /* --- PET AREA --- */
        .pet-stage { 
            width: 100%; height: 100%; 
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; 
            padding: 20px;
        }
        .pet-svg { width: 140px; height: 140px; filter: drop-shadow(0 0 10px var(--accent)); }
        
        .progress-block { width: 100%; margin-top: 20px; }
        .progress-track { width: 100%; height: 6px; background: rgba(0,0,0,0.3); border-radius: 3px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.2s; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.open { display: flex; }
        .modal-content {
            background: var(--card-bg); border: 1px solid var(--accent);
            padding: 2px; border-radius: 8px; max-width: 600px; width: 90%;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }
        .modal-inner {
            background: rgba(0,0,0,0.2); padding: 30px;
            display: flex; flex-direction: column; align-items: center;
        }
        .modal-title { font-family: var(--font-display); font-size: 1.5rem; margin-bottom: 20px; color: var(--accent); text-transform: uppercase; }
        .key-badge { 
            display: inline-block; padding: 4px 8px; background: rgba(255,255,255,0.1);
            border: 1px solid currentColor; border-radius: 4px; font-size: 0.8em; 
            font-family: var(--font-main);
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 1280px) {
            .app-container { max-width: 100%; padding: 12px; }
            .key { width: 44px; height: 44px; margin: 0 3px; }
            .key.w-1-5 { width: 66px; }
            .key.w-1-75 { width: 77px; }
            .key.w-2 { width: 88px; }
            .key.w-2-25 { width: 99px; }
            .key.w-2-5 { width: 110px; }
            .key.w-6 { width: 272px; }
            .text-display { font-size: 1.5rem; }
        }

        @media (max-width: 1024px) {
            .app-container {
                grid-template-areas: "stats stats" "arena arena" "keyboard keyboard" "bottom bottom";
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto auto;
            }
            .area-pet { display: none; }
            .keyboard-wrapper { transform: scale(0.9); }
        }

        .mobile-blocker {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: var(--accent); z-index: 10000;
            display: none; align-items: center; justify-content: center; flex-direction: column; text-align: center; padding: 20px;
            font-family: var(--font-display);
        }
        @media (max-width: 768px) { .mobile-blocker { display: flex; } }

    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="theme-cyberpunk show-fingers">

    <!-- Effects Overlay -->
    <div class="scanlines"></div>
    <div class="vignette"></div>

    <div class="mobile-blocker">
        <h1 class="text-2xl mb-4">SYSTEM ERROR</h1>
        <p>TERMINAL REQUIRES DESKTOP KEYBOARD INPUT</p>
    </div>

    <div class="app-container">
        <!-- TOP: Stats -->
        <div class="card area-stats">
            <div class="card-header">Session Stats</div>
            <div class="card-body">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">WPM</span>
                        <span class="stat-value" id="stats-wpm">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Accuracy</span>
                        <span class="stat-value" id="stats-acc">100%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Streak</span>
                        <span class="stat-value" id="stats-streak">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Time</span>
                        <span class="stat-value" id="stats-time">0:00</span>
                    </div>
                    <div class="stat-item cursor-pointer hover:text-[var(--accent)]" onclick="document.dispatchEvent(new KeyboardEvent('keydown',{'key':'t','altKey':true}))">
                        <span class="stat-label">Theme [Alt+T]</span>
                        <span class="stat-value text-xs">CYCLE</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- LEFT: Pet -->
        <div class="card area-pet">
            <div class="card-header">COMPANION.EXE</div>
            <div class="card-body">
                <div class="pet-stage">
                    <svg class="pet-svg pet-idle" viewBox="0 0 100 100" id="pet-display">
                        <g class="body" fill="currentColor" style="color: var(--accent)">
                            <rect x="30" y="40" width="40" height="40" rx="5" />
                            <rect x="30" y="20" width="40" height="30" rx="8" />
                            <path d="M30 20 L20 5 L40 20 Z" />
                            <path d="M70 20 L80 5 L60 20 Z" />
                            <circle cx="40" cy="35" r="3" fill="var(--bg-color)" />
                            <circle cx="60" cy="35" r="3" fill="var(--bg-color)" />
                            <path d="M70 70 Q90 90 90 50" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
                        </g>
                    </svg>
                    <div class="mt-4 font-bold text-[var(--accent)]" id="pet-name">Pixel Cat</div>
                    <div class="text-xs opacity-60">Lvl 1 • Next: 40 WPM</div>
                    
                    <div class="progress-block">
                        <div class="flex justify-between text-xs mb-1 opacity-70">
                            <span>PROGRESS</span>
                            <span id="prog-pct">0%</span>
                        </div>
                        <div class="progress-track">
                            <div id="progress-bar" class="progress-bar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CENTER: Arena -->
        <div class="card area-arena">
            <div class="card-header">
                <span>TERMINAL_INPUT</span>
                <span class="ml-auto opacity-50" id="mode-indicator">MODE: F2 (ALPHA)</span>
            </div>
            <div class="card-body">
                <div class="arena-wrapper">
                    <div id="typing-text" class="text-display">INITIALIZING SYSTEM...</div>
                    <div id="combo-display" class="combo-counter">0x COMBO</div>
                </div>
            </div>
        </div>

        <!-- KEYBOARD -->
        <div class="card area-keyboard" id="keyboard-container">
            <div class="card-header">VISUAL_INTERFACE</div>
            <div class="card-body flex items-center justify-center">
                <canvas id="fire-canvas"></canvas>
                <div class="keyboard-wrapper" id="visual-keyboard">
                    <!-- JS Injected -->
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="card area-bottom">
            <div class="card-body flex items-center justify-between px-6">
                <div class="font-bold">BEST: <span id="stat-best" class="text-[var(--accent)]">0</span> WPM</div>
                <div id="achievements-list" class="flex gap-2"></div>
                <div class="text-xs opacity-50 font-mono tracking-widest">[Alt+H] COMMANDS • [ESC] PAUSE</div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="help-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="card-header">SYSTEM_HELP</div>
            <div class="modal-inner">
                <h2 class="modal-title">KEY_COMMANDS</h2>
                <div class="grid grid-cols-2 gap-x-12 gap-y-4 text-left text-sm mb-8 w-full px-8">
                    <div class="flex justify-between"><span>Switch Mode</span> <span class="key-badge">F1-F5</span></div>
                    <div class="flex justify-between"><span>Cycle Theme</span> <span class="key-badge">Alt+T</span></div>
                    <div class="flex justify-between"><span>Toggle Sound</span> <span class="key-badge">Alt+S</span></div>
                    <div class="flex justify-between"><span>Toggle Fingers</span> <span class="key-badge">Alt+F</span></div>
                    <div class="flex justify-between"><span>Toggle Fire</span> <span class="key-badge">Alt+X</span></div>
                    <div class="flex justify-between"><span>Reset</span> <span class="key-badge">Alt+R</span></div>
                    <div class="flex justify-between"><span>Pause</span> <span class="key-badge">Esc</span></div>
                </div>
                <button class="px-8 py-2 border border-[var(--accent)] text-[var(--accent)] hover:bg-[var(--accent)] hover:text-[var(--bg-color)] rounded font-bold transition-colors" onclick="toggleModal('help-modal')">CLOSE</button>
            </div>
        </div>
    </div>

    <div id="pause-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="card-header">SYSTEM_PAUSED</div>
            <div class="modal-inner">
                <h2 class="modal-title blink">WAITING FOR INPUT</h2>
                <button class="px-8 py-2 bg-[var(--accent)] text-[var(--bg-color)] rounded font-bold" id="resume-btn">RESUME</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * IGNITE TYPE - SINGLE FILE IMPLEMENTATION
         */

        // --- DATA CORPUS ---
        const CORPUS = {
            homeRow: "adfljks sad flask salads falls asks dads",
            common: "the be to of and a in that have I it for not on with he as you do at this but his by from they we say her she or an will my one all would there their what so up out if about who get which go me when make can like time no just him know take people into year your good some could them see other than then now look only come its over think also back after use two how our work first well way even new want because any these give day most us",
            sentences: [
                "The quick brown fox jumps over the lazy dog.",
                "Pack my box with five dozen liquor jugs.",
                "How vexingly quick daft zebras jump!",
                "Sphinx of black quartz, judge my vow.",
                "Two driven jocks help fax my big quiz."
            ],
            paragraphs: [
                "It was a bright cold day in April, and the clocks were striking thirteen. Winston Smith, his chin nuzzled into his breast in an effort to escape the vile wind, slipped quickly through the glass doors of Victory Mansions, though not quickly enough to prevent a swirl of gritty dust from entering along with him.",
                "The sky above the port was the color of television, tuned to a dead channel. 'It's not like I'm using,' Case heard someone say, as he shouldered his way through the crowd around the door of the Chat. 'It's like my body's developed this massive drug deficiency.'",
                "Far out in the uncharted backwaters of the unfashionable end of the western spiral arm of the Galaxy lies a small unregarded yellow sun. Orbiting this at a distance of roughly ninety-two million miles is an utterly insignificant little blue green planet."
            ],
            code: [
                "function hello(name) { return `Hello ${name}`; }",
                "const array = [1, 2, 3].map(n => n * 2);",
                "document.getElementById('app').innerHTML = '<h1>Hi</h1>';",
                "for (let i = 0; i < 10; i++) { console.log(i); }",
                "import React, { useState } from 'react';",
                ".container { display: flex; justify-content: center; }"
            ]
        };

        // --- STATE & CONFIG ---
        const CONFIG = {
            themes: ['theme-cyberpunk', 'theme-glass', 'theme-pixel', 'theme-bento', 'theme-retro'],
            modes: ['F1', 'F2', 'F3', 'F4', 'F5'],
        };

        const STATE = {
            themeIdx: 0,
            modeIdx: 1, // Start at F2 (Alpha)
            soundEnabled: true,
            fireEnabled: true,
            fingersEnabled: true,
            isPlaying: false,
            isPaused: false,
            text: "",
            cursor: 0,
            startTime: 0,
            wpm: 0,
            errors: 0,
            correctChars: 0,
            streak: 0,
            maxStreak: 0,
            lastKeystroke: 0,
            petLevel: 1,
            totalTyped: 0
        };

        // --- DOM ELEMENTS ---
        const $ = (id) => document.getElementById(id);
        const canvas = $('fire-canvas');
        const ctx = canvas.getContext('2d');
        
        // --- KEYBOARD LAYOUT DEFINITION ---
        const KEYBOARD_ROWS = [
            [
                {k:'`', s:'finger-p-l'}, {k:'1', s:'finger-p-l'}, {k:'2', s:'finger-r-l'}, {k:'3', s:'finger-m-l'}, {k:'4', s:'finger-i-l'}, {k:'5', s:'finger-i-l'}, {k:'6', s:'finger-i-r'}, {k:'7', s:'finger-i-r'}, {k:'8', s:'finger-m-r'}, {k:'9', s:'finger-r-r'}, {k:'0', s:'finger-p-r'}, {k:'-', s:'finger-p-r'}, {k:'=', s:'finger-p-r'}, {k:'←', w:'w-2', s:'finger-p-r', code: 'Backspace'}
            ],
            [
                {k:'Tab', w:'w-1-5', s:'finger-p-l', code: 'Tab'}, {k:'Q', s:'finger-p-l'}, {k:'W', s:'finger-r-l'}, {k:'E', s:'finger-m-l'}, {k:'R', s:'finger-i-l'}, {k:'T', s:'finger-i-l'}, {k:'Y', s:'finger-i-r'}, {k:'U', s:'finger-i-r'}, {k:'I', s:'finger-m-r'}, {k:'O', s:'finger-r-r'}, {k:'P', s:'finger-p-r'}, {k:'[', s:'finger-p-r'}, {k:']', s:'finger-p-r'}, {k:'\\', s:'finger-p-r'}
            ],
            [
                {k:'CAPS', w:'w-1-75', s:'finger-p-l', code: 'CapsLock'}, {k:'A', s:'finger-p-l'}, {k:'S', s:'finger-r-l'}, {k:'D', s:'finger-m-l'}, {k:'F', s:'finger-i-l'}, {k:'G', s:'finger-i-l'}, {k:'H', s:'finger-i-r'}, {k:'J', s:'finger-i-r'}, {k:'K', s:'finger-m-r'}, {k:'L', s:'finger-r-r'}, {k:';', s:'finger-p-r'}, {k:"'", s:'finger-p-r'}, {k:'ENTER', w:'w-2-25', s:'finger-p-r', code: 'Enter'}
            ],
            [
                {k:'SHIFT', w:'w-2-5', s:'finger-p-l', code: 'ShiftLeft'}, {k:'Z', s:'finger-p-l'}, {k:'X', s:'finger-r-l'}, {k:'C', s:'finger-m-l'}, {k:'V', s:'finger-i-l'}, {k:'B', s:'finger-i-l'}, {k:'N', s:'finger-i-r'}, {k:'M', s:'finger-i-r'}, {k:',', s:'finger-m-r'}, {k:'.', s:'finger-r-r'}, {k:'/', s:'finger-p-r'}, {k:'SHIFT', w:'w-2-5', s:'finger-p-r', code: 'ShiftRight'}
            ],
            [
                {k:'CTRL', w:'w-1-5', code: 'ControlLeft'}, {k:'ALT', w:'w-1-5', code: 'AltLeft'}, {k:'SPACE', w:'w-6', s:'finger-t', code: 'Space'}, {k:'ALT', w:'w-1-5', code: 'AltRight'}, {k:'CTRL', w:'w-1-5', code: 'ControlRight'}
            ]
        ];

        // --- AUDIO SYSTEM (Procedural) ---
        const AudioSys = {
            ctx: null,
            init: function() {
                if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            },
            playClick: function() {
                if (!STATE.soundEnabled || !this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                // Randomize slightly for "mechanical" feel
                const detune = Math.random() * 20 - 10;
                
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(600 + detune, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, this.ctx.currentTime + 0.05);
                
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.05);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.05);
            },
            playError: function() {
                if (!STATE.soundEnabled || !this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, this.ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, this.ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.1);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.1);
            },
            playCombo: function() {
                if (!STATE.soundEnabled || !this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, this.ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.3);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.3);
            }
        };

        // --- INITIALIZATION ---
        function init() {
            // Render Keyboard
            const kbContainer = $('visual-keyboard');
            KEYBOARD_ROWS.forEach(row => {
                const rowEl = document.createElement('div');
                rowEl.className = 'kb-row';
                row.forEach(keyCfg => {
                    const keyEl = document.createElement('div');
                    keyEl.className = `key ${keyCfg.w || ''} ${keyCfg.s || ''}`;
                    // Use data-label for CSS ::before content
                    keyEl.setAttribute('data-label', keyCfg.k);
                    
                    // Logic mapping
                    keyEl.dataset.key = keyCfg.k.toLowerCase();
                    // Special handling for labels vs keys
                    if(keyCfg.k === 'SPACE') keyEl.dataset.key = ' ';
                    if(keyCfg.k === '←') keyEl.dataset.key = 'backspace';
                    
                    if(keyCfg.code) keyEl.dataset.code = keyCfg.code;
                    rowEl.appendChild(keyEl);
                });
                kbContainer.appendChild(rowEl);
            });

            // LocalStorage Load
            loadProgress();

            // Set Initial Mode
            resetGame();

            // Event Listeners
            window.addEventListener('keydown', handleKeyDown);
            window.addEventListener('keyup', handleKeyUp);
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('blur', () => { if(STATE.isPlaying) togglePause(true); });
            $('resume-btn').addEventListener('click', () => togglePause(false));

            // Start Loop
            resizeCanvas();
            requestAnimationFrame(gameLoop);
        }

        // --- GAME LOGIC ---

        function generateText() {
            const mode = CONFIG.modes[STATE.modeIdx];
            let content = "";
            
            if (mode === 'F1') {
                const words = CORPUS.homeRow.split(' ');
                content = Array.from({length: 8}, () => words[Math.floor(Math.random() * words.length)]).join(' ');
            } else if (mode === 'F2') {
                const words = CORPUS.common.split(' ');
                content = Array.from({length: 15}, () => words[Math.floor(Math.random() * words.length)]).join(' ');
            } else if (mode === 'F3') {
                content = CORPUS.sentences[Math.floor(Math.random() * CORPUS.sentences.length)] + " " + CORPUS.sentences[Math.floor(Math.random() * CORPUS.sentences.length)];
            } else if (mode === 'F4') {
                content = CORPUS.paragraphs[Math.floor(Math.random() * CORPUS.paragraphs.length)];
            } else if (mode === 'F5') {
                 content = CORPUS.code[Math.floor(Math.random() * CORPUS.code.length)];
            }

            return content.trim();
        }

        function resetGame() {
            STATE.text = generateText();
            STATE.cursor = 0;
            STATE.errors = 0;
            STATE.correctChars = 0;
            STATE.streak = 0;
            STATE.startTime = 0;
            STATE.isPlaying = false;
            STATE.isPaused = false;
            
            renderText();
            updateStats();
            highlightNextKey();
            $('combo-display').classList.remove('visible');
        }

        function renderText() {
            const container = $('typing-text');
            container.innerHTML = '';
            
            STATE.text.split('').forEach((char, idx) => {
                const span = document.createElement('span');
                span.textContent = char;
                span.className = 'char';
                if (idx === STATE.cursor) span.classList.add('current');
                container.appendChild(span);
            });
            
            highlightNextKey();
        }

        function updateStats() {
            // WPM Calc
            if (STATE.startTime && STATE.isPlaying) {
                const elapsed = (Date.now() - STATE.startTime) / 60000;
                const wpm = Math.round((STATE.correctChars / 5) / (elapsed || 0.001));
                STATE.wpm = wpm > 0 ? wpm : 0;
            }

            $('stats-wpm').textContent = STATE.wpm;
            $('stats-streak').textContent = STATE.streak;
            
            // Combo
            const comboEl = $('combo-display');
            if (STATE.streak >= 5) {
                comboEl.textContent = `${STATE.streak}x COMBO`;
                comboEl.classList.add('visible');
                if (STATE.streak % 10 === 0) AudioSys.playCombo();
            } else {
                comboEl.classList.remove('visible');
            }

            fireIntensity = STATE.wpm > 80 ? 3 : STATE.wpm > 55 ? 2 : STATE.wpm > 40 ? 1 : 0;
            
            // Progress
            const prog = Math.floor((STATE.cursor / STATE.text.length) * 100);
            $('progress-bar').style.width = `${prog}%`;
            $('prog-pct').textContent = `${prog}%`;
        }

        function highlightNextKey() {
            document.querySelectorAll('.next-hint').forEach(el => el.classList.remove('next-hint'));
            
            if (STATE.cursor >= STATE.text.length) return;

            const char = STATE.text[STATE.cursor].toLowerCase();
            let selector = `.key[data-key="${char}"]`;
            if (char === ' ') selector = `.key[data-code="Space"]`;
            
            const keyEl = document.querySelector(selector);
            if (keyEl) keyEl.classList.add('next-hint');
        }

        // --- INPUT HANDLING ---
        function handleKeyDown(e) {
            if (STATE.isPaused && e.key !== 'Escape') return;

            // Shortcuts
            if (e.altKey) {
                if (e.key === 't') { cycleTheme(); e.preventDefault(); return; }
                if (e.key === 's') { STATE.soundEnabled = !STATE.soundEnabled; e.preventDefault(); return; }
                if (e.key === 'f') { document.body.classList.toggle('show-fingers'); e.preventDefault(); return; }
                if (e.key === 'x') { STATE.fireEnabled = !STATE.fireEnabled; e.preventDefault(); return; }
                if (e.key === 'r') { resetGame(); e.preventDefault(); return; }
                if (e.key === 'h') { toggleModal('help-modal'); e.preventDefault(); return; }
            }

            if (e.key === 'Escape') { togglePause(); return; }
            if (e.key.startsWith('F') && e.key.length === 2) {
                const idx = parseInt(e.key[1]) - 1;
                if (idx >= 0 && idx < 5) {
                    STATE.modeIdx = idx;
                    $('mode-indicator').textContent = `MODE: ${CONFIG.modes[idx]}`;
                    resetGame();
                    e.preventDefault();
                    return;
                }
            }

            // Visuals
            const code = e.code;
            const keyEl = document.querySelector(`.key[data-code="${code}"]`) || 
                          document.querySelector(`.key[data-key="${e.key.toLowerCase()}"]`);
            
            if (keyEl) {
                keyEl.classList.add('active');
                spawnFire(keyEl);
            }

            // Typing
            if (e.key.length === 1 || e.key === 'Backspace') {
                e.preventDefault();
                
                if (!STATE.isPlaying && e.key.length === 1) {
                    STATE.isPlaying = true;
                    STATE.startTime = Date.now();
                    AudioSys.init();
                }

                if (STATE.cursor >= STATE.text.length) return;

                const targetChar = STATE.text[STATE.cursor];
                const charEls = $('typing-text').children;

                if (e.key === targetChar) {
                    // CORRECT
                    charEls[STATE.cursor].classList.add('correct');
                    charEls[STATE.cursor].classList.remove('current');
                    STATE.cursor++;
                    if (STATE.cursor < STATE.text.length) charEls[STATE.cursor].classList.add('current');
                    
                    STATE.correctChars++;
                    STATE.streak++;
                    AudioSys.playClick();
                    createGhostText(e.key, keyEl);
                    
                    if (STATE.cursor === STATE.text.length) {
                        finishRound();
                    }
                } else {
                    // INCORRECT
                    if (e.key !== targetChar) {
                        STATE.errors++;
                        STATE.streak = 0;
                        const kb = $('visual-keyboard');
                        kb.classList.remove('shake');
                        void kb.offsetWidth; 
                        kb.classList.add('shake');
                        AudioSys.playError();
                        charEls[STATE.cursor].classList.add('incorrect');
                    }
                }
                updateStats();
                highlightNextKey();
            }
        }

        function handleKeyUp(e) {
            const code = e.code;
            const keyEl = document.querySelector(`.key[data-code="${code}"]`) || 
                          document.querySelector(`.key[data-key="${e.key.toLowerCase()}"]`);
            if (keyEl) keyEl.classList.remove('active');
        }

        function createGhostText(char, keyEl) {
            if (!keyEl) return;
            const rect = keyEl.getBoundingClientRect();
            const ghost = document.createElement('div');
            ghost.textContent = char;
            ghost.className = 'ghost-char';
            const drift = (Math.random() * 40 - 20) + 'px';
            ghost.style.setProperty('--drift', drift);
            ghost.style.left = (rect.left + rect.width/2) + 'px';
            ghost.style.top = (rect.top) + 'px';
            document.body.appendChild(ghost);
            ghost.addEventListener('animationend', () => ghost.remove());
        }

        function finishRound() {
            STATE.isPlaying = false;
            STATE.totalTyped += STATE.text.length;
            localStorage.setItem('ignite_total_chars', STATE.totalTyped);
            
            const flash = document.createElement('div');
            flash.style.cssText = `position:fixed;top:0;left:0;width:100%;height:100%;background:var(--text-main);opacity:0.2;z-index:100;transition:opacity 0.5s`;
            document.body.appendChild(flash);
            setTimeout(() => { flash.style.opacity=0; setTimeout(()=>flash.remove(), 500); }, 100);

            if (STATE.wpm > parseInt(localStorage.getItem('ignite_best_wpm') || 0)) {
                localStorage.setItem('ignite_best_wpm', STATE.wpm);
                $('stat-best').textContent = STATE.wpm;
            }

            setTimeout(resetGame, 1000);
        }

        function togglePause(force) {
            if (force !== undefined) STATE.isPaused = force;
            else STATE.isPaused = !STATE.isPaused;

            const modal = $('pause-modal');
            if (STATE.isPaused) {
                modal.classList.add('open');
                STATE.pauseStartTime = Date.now();
            } else {
                modal.classList.remove('open');
                if (STATE.pauseStartTime) {
                    STATE.startTime += (Date.now() - STATE.pauseStartTime);
                    STATE.pauseStartTime = null;
                }
            }
        }

        // --- FIRE & PARTICLES ---
        let particles = [];
        let fireIntensity = 0; 

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 1.5;
                this.vy = -(Math.random() * 2 + 2 + fireIntensity); 
                this.life = 1.0;
                this.decay = Math.random() * 0.03 + 0.01;
                this.size = Math.random() * 5 + 4 + (fireIntensity * 2);
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life -= this.decay;
                this.size *= 0.95;
            }
            draw(ctx) {
                const baseHue = getComputedStyle(document.body).getPropertyValue('--fire-base').trim();
                const hue = parseInt(baseHue) + (1 - this.life) * 40; 
                const alpha = this.life;
                
                ctx.globalCompositeOperation = 'screen';
                ctx.fillStyle = `hsla(${hue}, 100%, 50%, ${alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function spawnFire(keyEl) {
            if (!STATE.fireEnabled) return;
            const rect = keyEl.getBoundingClientRect();
            const canvasRect = canvas.getBoundingClientRect();
            
            const count = 5 + (fireIntensity * 3);
            
            for(let i=0; i<count; i++) {
                const px = (rect.left - canvasRect.left) + (Math.random() * rect.width);
                const py = (rect.bottom - canvasRect.top) - 5;
                particles.push(new Particle(px, py));
            }
        }

        function resizeCanvas() {
            const rect = $('keyboard-container').getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (STATE.fireEnabled) {
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.update();
                    p.draw(ctx);
                    if (p.life <= 0) particles.splice(i, 1);
                }
                
                if (fireIntensity >= 2 && Math.random() > 0.8) {
                     const x = Math.random() * canvas.width;
                     particles.push(new Particle(x, canvas.height));
                }
            }

            requestAnimationFrame(gameLoop);
        }

        // --- UTILS ---
        function cycleTheme() {
            document.body.classList.remove(CONFIG.themes[STATE.themeIdx]);
            STATE.themeIdx = (STATE.themeIdx + 1) % CONFIG.themes.length;
            document.body.classList.add(CONFIG.themes[STATE.themeIdx]);
            localStorage.setItem('ignite_theme', STATE.themeIdx);
        }

        function toggleModal(id) {
            const el = $(id);
            el.classList.toggle('open');
            if (el.classList.contains('open')) {
                togglePause(true);
            } else {
                togglePause(false);
            }
        }

        function loadProgress() {
            const savedTheme = localStorage.getItem('ignite_theme');
            if (savedTheme) {
                document.body.classList.remove(CONFIG.themes[0]);
                STATE.themeIdx = parseInt(savedTheme);
                document.body.classList.add(CONFIG.themes[STATE.themeIdx]);
            }
            $('stat-best').textContent = localStorage.getItem('ignite_best_wpm') || 0;
            STATE.totalTyped = parseInt(localStorage.getItem('ignite_total_chars') || 0);
        }

        // --- START ---
        window.onload = init;

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>